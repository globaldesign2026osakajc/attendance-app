<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <title>ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ - ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼š å‡ºæ¬ ç®¡ç†</title>
  <link rel="stylesheet" href="css/common.css">
  <style>
    .page-header {
      margin-bottom: 2.5rem;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      padding: 2rem;
      border-radius: 16px;
      color: white;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .page-title::before {
      content: 'ğŸ‘¥';
      font-size: 2.5rem;
    }

    .page-subtitle {
      font-size: 1rem;
      opacity: 0.95;
      margin: 0;
    }

    .filters {
      background: linear-gradient(to bottom, #ffffff, #f8fafc);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .filter-row {
      display: flex;
      gap: 1.25rem;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .filter-group {
      flex: 1;
      min-width: 220px;
    }

    .filter-label {
      display: block;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.625rem;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filter-label::before {
      content: 'ğŸ”';
      font-size: 1rem;
    }

    .filter-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-size: 0.938rem;
      transition: all 0.3s ease;
      background-color: white;
    }

    .filter-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }

    .members-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
    }

    .member-card {
      background: linear-gradient(to bottom right, #ffffff, #fafbfc);
      border-radius: 16px;
      padding: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: 2px solid transparent;
      overflow: hidden;
      position: relative;
    }

    .member-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .member-card:hover::before {
      opacity: 1;
    }

    .member-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
      border-color: var(--primary-color);
    }

    .member-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      padding: 1.5rem 1.5rem 1rem 1.5rem;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));
    }

    .member-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }

    .member-card:hover .member-photo {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .member-info {
      flex: 1;
    }

    .member-name {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color);
      margin: 0 0 0.375rem 0;
      line-height: 1.3;
    }

    .member-position {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0;
      padding: 0.25rem 0.75rem;
      background-color: rgba(59, 130, 246, 0.1);
      border-radius: 20px;
      display: inline-block;
      font-weight: 500;
    }

    .member-details {
      padding: 1rem 1.5rem 1.5rem 1.5rem;
      background-color: white;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding: 0.625rem 0;
      font-size: 0.875rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .detail-row:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }

    .detail-label {
      color: var(--text-secondary);
      font-weight: 600;
    }

    .detail-value {
      color: var(--text-color);
      font-weight: 500;
      text-align: right;
    }

    .no-members {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }

    .no-members-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      background-color: white;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background-color: white;
      border-radius: 16px 16px 0 0;
      z-index: 1;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color);
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.3s ease;
    }

    .modal-close:hover {
      color: var(--text-color);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .profile-section {
      text-align: center;
      margin-bottom: 2rem;
    }

    .profile-photo-large {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--border-color);
      margin-bottom: 1rem;
    }

    .profile-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin: 0 0 0.5rem 0;
    }

    .profile-position {
      font-size: 1rem;
      color: var(--text-secondary);
      margin: 0;
    }

    .profile-details {
      background-color: var(--background-color);
      border-radius: 8px;
      padding: 1.5rem;
    }

    .profile-detail-row {
      display: flex;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .profile-detail-row:last-child {
      border-bottom: none;
    }

    .profile-detail-label {
      flex: 0 0 120px;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .profile-detail-value {
      flex: 1;
      color: var(--text-color);
      font-size: 0.938rem;
    }

    @media (max-width: 768px) {
      .members-grid {
        grid-template-columns: 1fr;
      }

      .filter-row {
        flex-direction: column;
      }

      .filter-group {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
  </div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-container">
      <!-- ãƒˆãƒƒãƒ—ãƒãƒ¼ -->
      <div class="header-top">
        <h1 class="header-title">å‡ºæ¬ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <div class="header-user">
          <span id="userName" class="header-user-name"></span>
          <button id="mobileNavToggle" class="mobile-nav-toggle">â˜°</button>
          <button id="logoutBtn" class="btn btn-secondary btn-sm">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
      </div>

      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <nav class="nav">
        <div class="nav-container">
          <a href="home.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">HOME</span>
          </a>
          <a href="events.html" class="nav-item">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-text">ã‚¤ãƒ™ãƒ³ãƒˆ</span>
          </a>
          <a href="members.html" class="nav-item active">
            <span class="nav-icon">ğŸ‘¥</span>
            <span class="nav-text">ãƒ¡ãƒ³ãƒãƒ¼</span>
          </a>
          <a href="history.html" class="nav-item">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">å±¥æ­´</span>
          </a>
          <a href="receipts.html" class="nav-item">
            <span class="nav-icon">ğŸ§¾</span>
            <span class="nav-text">é ˜åæ›¸</span>
          </a>
          <a href="profile.html" class="nav-item">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-text">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
          </a>
          <!-- ç®¡ç†è€…ç”¨ãƒªãƒ³ã‚¯ -->
          <a href="admin/dashboard.html" id="adminLink" class="nav-item" style="display: none;">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-text">ç®¡ç†ç”»é¢</span>
          </a>
        </div>
      </nav>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main-content">
    <div class="container">
      <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="page-header">
        <h2 class="page-title">ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</h2>
        <p class="page-subtitle">ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼šã®ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±</p>
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div class="filters">
        <div class="filter-row">
          <div class="filter-group">
            <label for="searchName" class="filter-label">æ°åæ¤œç´¢</label>
            <input type="text" id="searchName" class="filter-input" placeholder="æ°åã§æ¤œç´¢...">
          </div>
          <div class="filter-group">
            <label for="filterAffiliation" class="filter-label">æ‰€å±</label>
            <select id="filterAffiliation" class="filter-input">
              <option value="">ã™ã¹ã¦</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="filterBirthMonth" class="filter-label">èª•ç”Ÿæœˆ</label>
            <select id="filterBirthMonth" class="filter-input">
              <option value="">ã™ã¹ã¦</option>
              <option value="1">1æœˆ</option>
              <option value="2">2æœˆ</option>
              <option value="3">3æœˆ</option>
              <option value="4">4æœˆ</option>
              <option value="5">5æœˆ</option>
              <option value="6">6æœˆ</option>
              <option value="7">7æœˆ</option>
              <option value="8">8æœˆ</option>
              <option value="9">9æœˆ</option>
              <option value="10">10æœˆ</option>
              <option value="11">11æœˆ</option>
              <option value="12">12æœˆ</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ -->
      <div id="membersContainer" class="members-grid">
        <!-- ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
      </div>
    </div>
  </main>

  <!-- ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="memberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°</h3>
        <button class="modal-close" onclick="closeMemberModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="profile-section">
          <img id="modalPhoto" class="profile-photo-large" src="" alt="Profile Photo">
          <h3 id="modalName" class="profile-name"></h3>
          <p id="modalPosition" class="profile-position"></p>
        </div>
        <div class="profile-details">
          <div class="profile-detail-row">
            <div class="profile-detail-label">ãƒ•ãƒªã‚¬ãƒŠ</div>
            <div id="modalKana" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">ã‚ã å</div>
            <div id="modalNickname" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å½¹è·</div>
            <div id="modalPositionDetail" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">æ‰€å±</div>
            <div id="modalAffiliation" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">èª•ç”Ÿæ—¥</div>
            <div id="modalBirthday" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">ä¸€è¨€</div>
            <div id="modalComment" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">LINEå</div>
            <div id="modalLineName" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å…¥ä¼šå¹´åº¦</div>
            <div id="modalJoinYear" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å‡ºå‘å…ˆ</div>
            <div id="modalSecondment" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">é›»è©±ç•ªå·</div>
            <div id="modalPhone" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">ä¼šç¤¾å</div>
            <div id="modalCompany" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">æ¥­ç¨®</div>
            <div id="modalIndustry" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</div>
            <div id="modalAllergy" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å¥½ããªã‚‚ã®</div>
            <div id="modalFavorite" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å«Œã„ãªã‚‚ã®</div>
            <div id="modalDislike" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å¥½ããªå›½</div>
            <div id="modalFavoriteCountry" class="profile-detail-value"></div>
          </div>
          <div class="profile-detail-row">
            <div class="profile-detail-label">å¥½ããªè¨€è‘‰</div>
            <div id="modalFavoriteWord" class="profile-detail-value"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/nav.js"></script>
  <script>
    let allMembers = [];
    let currentUser = null;

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      // èªè¨¼ãƒã‚§ãƒƒã‚¯
      if (!Auth.isLoggedIn()) {
        window.location.href = '/index.html';
        return;
      }

      currentUser = Auth.getUserInfo();
      document.getElementById('userName').textContent = currentUser.name;

      // ç®¡ç†è€…ãƒªãƒ³ã‚¯è¡¨ç¤º
      if (currentUser.role === 'staff') {
        document.getElementById('adminLink').style.display = 'flex';
      }

      // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
      document.getElementById('logoutBtn').addEventListener('click', () => {
        Auth.logout();
        window.location.href = '/index.html';
      });

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
      document.getElementById('searchName').addEventListener('input', filterMembers);
      document.getElementById('filterAffiliation').addEventListener('change', filterMembers);
      document.getElementById('filterBirthMonth').addEventListener('change', filterMembers);

      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      await loadMembers();
    });

    // ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§å–å¾—
    async function loadMembers() {
      Utils.showLoading();

      try {
        const result = await API.call('getMembers', {});

        if (result.success) {
          allMembers = result.members;
          populateFilters();
          renderMembers(allMembers);
        } else {
          throw new Error(result.error || 'ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

      } catch (error) {
        console.error('Load members error:', error);
        Utils.showError('ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      } finally {
        Utils.hideLoading();
      }
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠè‚¢ã‚’è¨­å®š
    function populateFilters() {
      const affiliations = [...new Set(allMembers.map(m => m.affiliation).filter(a => a))];
      const affiliationSelect = document.getElementById('filterAffiliation');

      affiliations.forEach(affiliation => {
        const option = document.createElement('option');
        option.value = affiliation;
        option.textContent = affiliation;
        affiliationSelect.appendChild(option);
      });
    }

    // ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    function filterMembers() {
      const searchName = document.getElementById('searchName').value.toLowerCase();
      const filterAffiliation = document.getElementById('filterAffiliation').value;
      const filterBirthMonth = document.getElementById('filterBirthMonth').value;

      const filtered = allMembers.filter(member => {
        // æ°åæ¤œç´¢
        if (searchName && !member.name.toLowerCase().includes(searchName)) {
          return false;
        }

        // æ‰€å±ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (filterAffiliation && member.affiliation !== filterAffiliation) {
          return false;
        }

        // èª•ç”Ÿæœˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (filterBirthMonth) {
          if (!member.birthday) return false;
          const birthMonth = new Date(member.birthday).getMonth() + 1;
          if (birthMonth !== parseInt(filterBirthMonth)) {
            return false;
          }
        }

        return true;
      });

      renderMembers(filtered);
    }

    // ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’æç”»
    function renderMembers(members) {
      const container = document.getElementById('membersContainer');

      if (members.length === 0) {
        container.innerHTML = `
          <div class="no-members">
            <div class="no-members-icon">ğŸ‘¥</div>
            <p>è©²å½“ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
          </div>
        `;
        return;
      }

      // member_idã§ã‚½ãƒ¼ãƒˆ
      const sortedMembers = [...members].sort((a, b) => {
        const idA = a.member_id || '';
        const idB = b.member_id || '';
        return idA.localeCompare(idB);
      });

      const defaultPhoto = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23f1f5f9' width='100' height='100'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='%2394a3b8' font-size='40'%3EğŸ‘¤%3C/text%3E%3C/svg%3E";

      container.innerHTML = sortedMembers.map(member => {
        const photoUrl = member.PhotoURL || defaultPhoto;
        const birthday = member.birthday
          ? new Date(member.birthday).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })
          : '-';
        const nickname = member['ã‚ã å'] || '';
        const kana = member.kana || '';
        const comment = member['ä¸€è¨€'] || '';
        const affiliationColor = member.affiliation_color || null;

        // æ‰€å±ã‚«ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
        const cardStyle = affiliationColor
          ? `style="background: linear-gradient(to bottom right, ${affiliationColor}15, ${affiliationColor}08); border-left: 4px solid ${affiliationColor};"`
          : '';

        return `
          <div class="member-card" ${cardStyle} onclick="showMemberDetail('${Utils.escapeHtml(member.member_id)}')">
            <div class="member-header">
              <img class="member-photo" src="${photoUrl}" alt="${Utils.escapeHtml(member.name)}">
              <div class="member-info">
                <h3 class="member-name">${Utils.escapeHtml(member.name)}${nickname ? ' (' + Utils.escapeHtml(nickname) + ')' : ''}</h3>
                <p class="member-position">${Utils.escapeHtml(member.position || '-')}</p>
              </div>
            </div>
            <div class="member-details">
              <div class="detail-row">
                <span class="detail-label">ãƒ•ãƒªã‚¬ãƒŠ</span>
                <span class="detail-value">${Utils.escapeHtml(kana)}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">æ‰€å±</span>
                <span class="detail-value" ${affiliationColor ? `style="color: ${affiliationColor}; font-weight: 600;"` : ''}>${Utils.escapeHtml(member.affiliation || '-')}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">èª•ç”Ÿæ—¥</span>
                <span class="detail-value">${birthday}</span>
              </div>
              ${comment ? `<div class="detail-row">
                <span class="detail-label">ä¸€è¨€</span>
                <span class="detail-value">${Utils.escapeHtml(comment)}</span>
              </div>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    // ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°è¡¨ç¤º
    function showMemberDetail(memberId) {
      const member = allMembers.find(m => m.member_id === memberId);
      if (!member) return;

      const defaultPhoto = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23f1f5f9' width='100' height='100'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='%2394a3b8' font-size='40'%3EğŸ‘¤%3C/text%3E%3C/svg%3E";

      document.getElementById('modalPhoto').src = member.PhotoURL || defaultPhoto;
      document.getElementById('modalName').textContent = member.name;
      document.getElementById('modalPosition').textContent = member.position || '-';

      const birthday = member.birthday
        ? new Date(member.birthday).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })
        : '-';

      document.getElementById('modalKana').textContent = member.kana || '-';
      document.getElementById('modalNickname').textContent = member['ã‚ã å'] || '-';
      document.getElementById('modalPositionDetail').textContent = member.position || '-';
      document.getElementById('modalAffiliation').textContent = member.affiliation || '-';
      document.getElementById('modalBirthday').textContent = birthday;
      document.getElementById('modalComment').textContent = member['ä¸€è¨€'] || '-';
      document.getElementById('modalLineName').textContent = member['LINEå'] || '-';
      document.getElementById('modalJoinYear').textContent = member['å…¥ä¼šå¹´åº¦'] || '-';
      document.getElementById('modalSecondment').textContent = member['å‡ºå‘å…ˆ'] || '-';
      document.getElementById('modalPhone').textContent = member['é›»è©±ç•ªå·'] || '-';
      document.getElementById('modalCompany').textContent = member.company_name || '-';
      document.getElementById('modalIndustry').textContent = member['æ¥­ç¨®'] || '-';
      document.getElementById('modalAllergy').textContent = member['ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼'] || '-';
      document.getElementById('modalFavorite').textContent = member['å¥½ããªã‚‚ã®'] || '-';
      document.getElementById('modalDislike').textContent = member['å«Œã„ãªã‚‚ã®'] || '-';
      document.getElementById('modalFavoriteCountry').textContent = member['å¥½ããªå›½'] || '-';
      document.getElementById('modalFavoriteWord').textContent = member['å¥½ããªè¨€è‘‰'] || '-';

      document.getElementById('memberModal').classList.add('active');
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    function closeMemberModal() {
      document.getElementById('memberModal').classList.remove('active');
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    document.getElementById('memberModal').addEventListener('click', (e) => {
      if (e.target.id === 'memberModal') {
        closeMemberModal();
      }
    });
  </script>
</body>
</html>
