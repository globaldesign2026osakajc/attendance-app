# âœ… GASãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## ğŸ“‹ è¨­å®šæ¸ˆã¿é …ç›®

### âœ… Config.gs ã®è¨­å®š

ã™ã¹ã¦ã®å¿…è¦ãªIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™:

| é …ç›® | å€¤ | çŠ¶æ…‹ |
|-----|-----|------|
| **SPREADSHEET_ID** | `1HISXLL8sy-1ujm5Rv9FyMSGTvxxb-pK1j330TTxKzs` | âœ… |
| **PROFILE_PHOTO_FOLDER_ID** | `1snh_AVS3njT_xPoOhylhziGc4rRok_wp` | âœ… |
| **RECEIPT_FOLDER_ID** | `1M5AYlm8dIxKoP2hACr354GKoBP-bD270` | âœ… |
| **RECEIPT_TEMPLATE_ID** | `1-kkUg6BRoQzNcH9VT-cwq8Je_SsYcv9vA0Zct10eLik` | âœ… |
| **CALENDAR_ID** | `5fef5913662f58b2b1e26366ee9c7a830ce3a1231b1047c016ab49b46a447394@group.calendar.google.com` | âœ… |

### âœ… ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±

- **GAS Web App URL**:
  ```
  https://script.google.com/macros/s/AKfycbzTThSpmZmrYwPosNK2mhyk9KHgrJXUmwRX70pPVRO_-kT2T-VJpiC3TuG6YYlSvr0/exec
  ```

## ğŸ”§ å¿…é ˆè¨­å®š

### 1. Google Calendar API ã®æœ‰åŠ¹åŒ–

Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯:

1. Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œã‚µãƒ¼ãƒ“ã‚¹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒGoogle Calendar APIã€ã‚’æ¤œç´¢
4. è¿½åŠ ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v3
6. è¿½åŠ 

### 2. Apps Scriptã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç¢ºèª

ä»¥ä¸‹ã®12å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã™ã¹ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:

- [ ] Config.gs
- [ ] Code.gs
- [ ] Auth.gs
- [ ] Events.gs
- [ ] Attendance.gs
- [ ] Members.gs
- [ ] Checkin.gs
- [ ] Payments.gs
- [ ] Receipts.gs
- [ ] Analytics.gs
- [ ] Masters.gs
- [ ] Utils.gs

## ğŸ§ª å‹•ä½œãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆ1: ãƒ­ã‚°ã‚¤ãƒ³API

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹:

```
https://script.google.com/macros/s/AKfycbzTThSpmZmrYwPosNK2mhyk9KHgrJXUmwRX70pPVRO_-kT2T-VJpiC3TuG6YYlSvr0/exec?action=login&login_id=yamada&password=password123
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**
```json
{
  "success": true,
  "token": "xxxxxxxx...",
  "member_id": "M001",
  "name": "å±±ç”°å¤ªéƒ",
  "role": "staff"
}
```

### ãƒ†ã‚¹ãƒˆ2: ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—

ä¸Šè¨˜ã§å–å¾—ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨:

```
https://script.google.com/macros/s/AKfycbzTThSpmZmrYwPosNK2mhyk9KHgrJXUmwRX70pPVRO_-kT2T-VJpiC3TuG6YYlSvr0/exec?action=getMasters&token=å–å¾—ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**
```json
{
  "success": true,
  "masters": {
    "hosts": ["ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼š", "ç·å‹™å§”å“¡ä¼š", ...],
    "tags": ["å§”å“¡ä¼š", "æœˆä¾‹ä¼š", "ç·ä¼š", ...],
    ...
  }
}
```

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³: Cloudflare Workersã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

æœ¬ç•ªç’°å¢ƒã§ã¯ã€GAS URLã‚’ç›´æ¥å…¬é–‹ã›ãšã€Cloudflare WorkersçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

**Cloudflare Workers ã‚³ãƒ¼ãƒ‰:**

```javascript
export default {
  async fetch(request, env) {
    const url = new URL(request.url);

    // CORSè¨­å®š
    const corsHeaders = {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type',
    };

    // OPTIONSãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾å¿œ
    if (request.method === 'OPTIONS') {
      return new Response(null, { headers: corsHeaders });
    }

    // GAS APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€
    const gasUrl = new URL(env.GAS_API_URL);
    gasUrl.search = url.search;

    const response = await fetch(gasUrl.toString(), {
      method: request.method,
      headers: request.headers,
      body: request.body
    });

    const data = await response.text();

    return new Response(data, {
      headers: {
        ...corsHeaders,
        'Content-Type': 'application/json'
      }
    });
  }
}
```

**ç’°å¢ƒå¤‰æ•°è¨­å®š:**
- Name: `GAS_API_URL`
- Value: `https://script.google.com/macros/s/AKfycbzTThSpmZmrYwPosNK2mhyk9KHgrJXUmwRX70pPVRO_-kT2T-VJpiC3TuG6YYlSvr0/exec`
- Type: **Secret**

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º

æ¬¡ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆHTML/CSS/JavaScriptï¼‰ã®é–‹ç™ºã«é€²ã¿ã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `config.js` ã«ã¯:

**é–‹ç™ºç’°å¢ƒï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰:**
```javascript
const CONFIG = {
  API_URL: 'https://script.google.com/macros/s/AKfycbzTThSpmZmrYwPosNK2mhyk9KHgrJXUmwRX70pPVRO_-kT2T-VJpiC3TuG6YYlSvr0/exec',
  APP_NAME: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼š å‡ºæ¬ ç®¡ç†',
  CACHE_TTL: 5 * 60 * 1000,
  SESSION_TIMEOUT: 24 * 60 * 60 * 1000
};
```

**æœ¬ç•ªç’°å¢ƒï¼ˆCloudflare Workersä½¿ç”¨æ™‚ï¼‰:**
```javascript
const CONFIG = {
  API_URL: 'https://attendance-api-proxy.yourname.workers.dev',
  APP_NAME: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼š å‡ºæ¬ ç®¡ç†',
  CACHE_TTL: 5 * 60 * 1000,
  SESSION_TIMEOUT: 24 * 60 * 60 * 1000
};
```

## ğŸ‰ å®Œäº†!

GASãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ!

æ¬¡ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«é€²ã‚“ã§ãã ã•ã„ã€‚
