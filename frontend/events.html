<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <title>ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ - ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³æ¨é€²å§”å“¡ä¼š å‡ºæ¬ ç®¡ç†</title>
  <link rel="stylesheet" href="css/common.css">
  <style>
    .filter-section {
      background-color: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-color);
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      background-color: white;
      border-radius: 8px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      background-color: var(--primary-bg);
    }

    .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .search-box {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 0.875rem;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--primary-bg);
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
    }

    .event-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background-color: var(--gray-light);
      border-radius: 8px;
    }

    .event-count {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .sort-select {
      padding: 0.5rem 2rem 0.5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 0.875rem;
      background-color: white;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
    }

    .event-list {
      display: grid;
      gap: 1rem;
    }

    .event-card {
      background-color: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      cursor: pointer;
      border-left: 4px solid var(--border-color);
    }

    .event-card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }

    .event-card.past {
      opacity: 0.7;
      border-left-color: var(--text-light);
    }

    .event-card.urgent {
      border-left-color: var(--danger-color);
      background: linear-gradient(to right, #fff5f5 0%, white 10%);
    }

    .event-card.pending-registration {
      border-left-color: var(--warning-color);
      background: linear-gradient(to right, #fffbeb 0%, white 10%);
    }

    .event-card.attending {
      border-left-color: var(--success-color);
    }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .event-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-color);
      margin: 0;
      flex: 1;
    }

    .event-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .event-info {
      display: grid;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .event-info-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .event-info-icon {
      font-size: 1rem;
      min-width: 1.25rem;
      text-align: center;
    }

    .event-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border-color);
      margin-top: 0.75rem;
    }

    .attendance-status {
      font-weight: 600;
      font-size: 0.875rem;
    }

    .attendance-status.attend {
      color: var(--success-color);
    }

    .attendance-status.absent {
      color: var(--text-secondary);
    }

    .attendance-status.pending {
      color: var(--warning-color);
    }

    .deadline-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      background-color: var(--danger-bg);
      color: var(--danger-color);
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .deadline-badge.warning {
      background-color: var(--warning-bg);
      color: var(--warning-color);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
      background-color: white;
      border-radius: 12px;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 1rem;
      margin: 0;
    }

    @media (max-width: 768px) {
      .filter-row {
        grid-template-columns: 1fr;
      }

      .event-stats {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .event-header {
        flex-direction: column;
      }

      .event-badges {
        width: 100%;
      }

      .event-footer {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
  <div id="loading">
    <div class="spinner"></div>
  </div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-container">
      <!-- ãƒˆãƒƒãƒ—ãƒãƒ¼ -->
      <div class="header-top">
        <h1 class="header-title">å‡ºæ¬ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <div class="header-user">
          <span id="userName" class="header-user-name"></span>
          <button id="mobileNavToggle" class="mobile-nav-toggle">â˜°</button>
          <button id="logoutBtn" class="btn btn-secondary btn-sm">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
      </div>

      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <nav class="nav">
        <div class="nav-container">
          <a href="home.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">HOME</span>
          </a>
          <a href="events.html" class="nav-item active">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-text">ã‚¤ãƒ™ãƒ³ãƒˆ</span>
          </a>
          <a href="members.html" class="nav-item">
            <span class="nav-icon">ğŸ‘¥</span>
            <span class="nav-text">ãƒ¡ãƒ³ãƒãƒ¼</span>
          </a>
          <a href="history.html" class="nav-item">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">å±¥æ­´</span>
          </a>
          <a href="receipts.html" class="nav-item">
            <span class="nav-icon">ğŸ§¾</span>
            <span class="nav-text">é ˜åæ›¸</span>
          </a>
          <a href="profile.html" class="nav-item">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-text">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
          </a>
          <!-- ç®¡ç†è€…ç”¨ãƒªãƒ³ã‚¯ -->
          <a href="admin/dashboard.html" id="adminLink" class="nav-item" style="display: none;">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-text">ç®¡ç†ç”»é¢</span>
          </a>
        </div>
      </nav>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main-content">
    <div class="container">
      <h2 class="page-title">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h2>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div class="filter-section">
        <div class="filter-row">
          <!-- æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
          <div class="filter-group">
            <label class="filter-label">æœŸé–“</label>
            <div class="filter-buttons">
              <button class="filter-btn active" data-period="upcoming">ä»Šå¾Œ</button>
              <button class="filter-btn" data-period="past">éå»</button>
              <button class="filter-btn" data-period="all">ã™ã¹ã¦</button>
            </div>
          </div>

          <!-- å‡ºæ¬ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
          <div class="filter-group">
            <label class="filter-label">å‡ºæ¬ çŠ¶æ³</label>
            <div class="filter-buttons">
              <button class="filter-btn active" data-attendance="all">ã™ã¹ã¦</button>
              <button class="filter-btn" data-attendance="pending">æœªç™»éŒ²</button>
              <button class="filter-btn" data-attendance="attend">å‡ºå¸­</button>
              <button class="filter-btn" data-attendance="absent">æ¬ å¸­</button>
            </div>
          </div>

          <!-- æ¤œç´¢ -->
          <div class="filter-group">
            <label class="filter-label">æ¤œç´¢</label>
            <div class="search-box">
              <span class="search-icon">ğŸ”</span>
              <input
                type="text"
                id="searchInput"
                class="search-input"
                placeholder="ã‚¤ãƒ™ãƒ³ãƒˆåã§æ¤œç´¢..."
              >
            </div>
          </div>
        </div>
      </div>

      <!-- çµ±è¨ˆãƒ»ä¸¦ã³æ›¿ãˆ -->
      <div class="event-stats">
        <span class="event-count" id="eventCount">0ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆ</span>
        <select id="sortSelect" class="sort-select">
          <option value="date-asc">é–‹å‚¬æ—¥ï¼ˆè¿‘ã„é †ï¼‰</option>
          <option value="date-desc">é–‹å‚¬æ—¥ï¼ˆé ã„é †ï¼‰</option>
          <option value="deadline-asc">ç· åˆ‡æ—¥ï¼ˆè¿‘ã„é †ï¼‰</option>
          <option value="name-asc">åå‰ï¼ˆæ˜‡é †ï¼‰</option>
          <option value="name-desc">åå‰ï¼ˆé™é †ï¼‰</option>
        </select>
      </div>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ -->
      <div id="eventList" class="event-list"></div>
    </div>
  </main>

  <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ« -->
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/nav.js"></script>

  <script>
    let allEvents = [];
    let filteredEvents = [];
    const userInfo = Auth.getUserInfo();

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹
    let filters = {
      period: 'upcoming',
      attendance: 'all',
      search: ''
    };

    // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹
    let sortBy = 'date-asc';

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
    window.addEventListener('DOMContentLoaded', async () => {
      // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
      Auth.requireLogin();

      // ç®¡ç†è€…ã®å ´åˆã€ç®¡ç†ç”»é¢ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
      Auth.showAdminLinks();

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼åè¡¨ç¤º
      document.getElementById('userName').textContent = userInfo.name;

      // ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
      await loadEvents();

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      setupEventListeners();
    });

    // ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
    async function loadEvents() {
      Utils.showLoading();

      try {
        const result = await API.call('getEvents', {
          member_id: userInfo.memberId
        });

        if (result.success) {
          allEvents = result.events || [];
          applyFilters();
        } else {
          throw new Error(result.message || 'ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

      } catch (error) {
        console.error('Load events error:', error);
        Utils.showError('ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      } finally {
        Utils.hideLoading();
      }
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
    function applyFilters() {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

      filteredEvents = allEvents.filter(event => {
        const eventDate = new Date(event.date);

        // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (filters.period === 'upcoming' && eventDate < today) {
          return false;
        }
        if (filters.period === 'past' && eventDate >= today) {
          return false;
        }

        // å‡ºæ¬ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (filters.attendance === 'pending' && event.my_attendance_status) {
          return false;
        }
        if (filters.attendance === 'attend' && event.my_attendance_status !== 'å‡ºå¸­') {
          return false;
        }
        if (filters.attendance === 'absent' && event.my_attendance_status !== 'æ¬ å¸­') {
          return false;
        }

        // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        if (filters.search && !event.title.toLowerCase().includes(filters.search.toLowerCase())) {
          return false;
        }

        return true;
      });

      sortEvents();
      displayEvents();
    }

    // ã‚½ãƒ¼ãƒˆ
    function sortEvents() {
      filteredEvents.sort((a, b) => {
        switch (sortBy) {
          case 'date-asc':
            return new Date(a.date) - new Date(b.date);
          case 'date-desc':
            return new Date(b.date) - new Date(a.date);
          case 'deadline-asc':
            if (!a.attendance_deadline) return 1;
            if (!b.attendance_deadline) return -1;
            return new Date(a.attendance_deadline) - new Date(b.attendance_deadline);
          case 'name-asc':
            return a.title.localeCompare(b.title, 'ja');
          case 'name-desc':
            return b.title.localeCompare(a.title, 'ja');
          default:
            return 0;
        }
      });
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º
    function displayEvents() {
      const container = document.getElementById('eventList');
      const countElement = document.getElementById('eventCount');

      // ä»¶æ•°è¡¨ç¤º
      countElement.textContent = `${filteredEvents.length}ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆ`;

      // ç©ºçŠ¶æ…‹
      if (filteredEvents.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“…</div>
            <p class="empty-state-text">è©²å½“ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
          </div>
        `;
        return;
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰è¡¨ç¤º
      container.innerHTML = filteredEvents.map(event => createEventCard(event)).join('');
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ä½œæˆ
    function createEventCard(event) {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const eventDate = new Date(event.date);
      const isPast = eventDate < today;

      const dateStr = Utils.formatDateSlash(event.date);
      const dayOfWeek = Utils.getDayOfWeek(event.date);
      const startTime = event.start_time ? Utils.formatTime(event.start_time) : '';
      const endTime = event.end_time ? Utils.formatTime(event.end_time) : '';

      // ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹
      let cardClasses = ['event-card'];
      if (isPast) {
        cardClasses.push('past');
      } else if (event.urgent) {
        cardClasses.push('urgent');
      } else if (!event.my_attendance_status && event.attendance_deadline && new Date(event.attendance_deadline) >= now) {
        cardClasses.push('pending-registration');
      } else if (event.my_attendance_status === 'å‡ºå¸­') {
        cardClasses.push('attending');
      }

      // å‡ºæ¬ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
      let attendanceStatus = '';
      let attendanceClass = '';
      const myStatus = event.my_attendance_status;

      if (!myStatus) {
        attendanceStatus = 'æœªç™»éŒ²';
        attendanceClass = 'pending';
      } else if (event.attendance_type === 'B') {
        // ã‚¿ã‚¤ãƒ—B: selected_optionã®å€¤ã‚’è¡¨ç¤º
        attendanceStatus = myStatus; // myStatusã«ã¯selected_optionãŒå…¥ã£ã¦ã„ã‚‹
        if (myStatus === 'æ¬ å¸­') {
          attendanceStatus = 'âœ— ' + myStatus;
          attendanceClass = 'absent';
        } else {
          // æ¬ å¸­ä»¥å¤–ã¯å‡ºå¸­æ‰±ã„
          attendanceStatus = 'âœ“ ' + myStatus;
          attendanceClass = 'attend';
        }
      } else {
        // ã‚¿ã‚¤ãƒ—A: é€šå¸¸ã®å‡ºå¸­/æ¬ å¸­
        if (myStatus === 'å‡ºå¸­') {
          attendanceStatus = 'âœ“ å‡ºå¸­äºˆå®š';
          attendanceClass = 'attend';
        } else if (myStatus === 'æ¬ å¸­') {
          attendanceStatus = 'âœ— æ¬ å¸­';
          attendanceClass = 'absent';
        } else {
          attendanceStatus = myStatus;
          attendanceClass = 'pending';
        }
      }

      // ãƒãƒƒã‚¸
      let badges = '';

      if (isPast) {
        badges += '<span class="badge badge-secondary">çµ‚äº†</span>';
      } else {
        if (event.urgent) {
          badges += '<span class="badge badge-danger">ç·Šæ€¥</span>';
        }

        if (event.attendance_deadline) {
          const daysUntil = Utils.getDaysUntil(event.attendance_deadline);
          if (daysUntil !== null && daysUntil <= 3 && !event.my_attendance_status) {
            const badgeClass = daysUntil <= 1 ? '' : 'warning';
            const deadlineText = daysUntil === 0 ? 'ä»Šæ—¥ã¾ã§' : `ã‚ã¨${daysUntil}æ—¥`;
            badges += `<span class="deadline-badge ${badgeClass}">â° ${deadlineText}</span>`;
          }
        }
      }

      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–™ç™ºç”Ÿæ—¥ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      let cancellationFeeText = '';
      if (event.cancellation_fee_date) {
        const feeDate = new Date(event.cancellation_fee_date);
        const evDate = new Date(event.date);
        const diffTime = evDate - feeDate;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const month = feeDate.getMonth() + 1;
        const day = feeDate.getDate();
        const dateStr = `${month}æœˆ${day}æ—¥`;

        if (diffDays > 0) {
          cancellationFeeText = `${dateStr}ï¼ˆ${diffDays}æ—¥å‰ï¼‰`;
        } else if (diffDays === 0) {
          cancellationFeeText = `${dateStr}ï¼ˆå½“æ—¥ï¼‰`;
        } else {
          cancellationFeeText = dateStr;
        }
      }

      return `
        <div class="${cardClasses.join(' ')}" onclick="location.href='event-detail.html?id=${event.event_id}'">
          <div class="event-header">
            <h3 class="event-title">${Utils.escapeHtml(event.title)}</h3>
            <div class="event-badges">${badges}</div>
          </div>

          <div class="event-info">
            <div class="event-info-row">
              <span class="event-info-icon">ğŸ“…</span>
              <span>${dateStr}ï¼ˆ${dayOfWeek}ï¼‰${startTime}${endTime ? ' - ' + endTime : ''}</span>
            </div>
            ${event.location ? `
              <div class="event-info-row">
                <span class="event-info-icon">ğŸ“</span>
                <span>${Utils.escapeHtml(event.location)}</span>
              </div>
            ` : ''}
            ${event.fee_amount > 0 ? `
              <div class="event-info-row">
                <span class="event-info-icon">ğŸ’°</span>
                <span>ç™»éŒ²æ–™: ${Utils.formatCurrency(event.fee_amount)}</span>
              </div>
            ` : ''}
            ${event.attendance_deadline ? `
              <div class="event-info-row">
                <span class="event-info-icon">â°</span>
                <span>å‡ºæ¬ ç· åˆ‡: ${Utils.formatDateSlash(event.attendance_deadline)}</span>
              </div>
            ` : ''}
            ${event.cancellation_fee_date ? `
              <div class="event-info-row">
                <span class="event-info-icon">ğŸ’³</span>
                <span>ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–™ç™ºç”Ÿ: ${cancellationFeeText}</span>
              </div>
            ` : ''}
          </div>

          <div class="event-footer">
            <span class="attendance-status ${attendanceClass}">${attendanceStatus}</span>
            <span class="view-all-link">è©³ç´°ã‚’è¦‹ã‚‹ â†’</span>
          </div>
        </div>
      `;
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
          await Auth.logout();
        }
      });

      // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      document.querySelectorAll('[data-period]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          filters.period = e.target.dataset.period;
          applyFilters();
        });
      });

      // å‡ºæ¬ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      document.querySelectorAll('[data-attendance]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('[data-attendance]').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          filters.attendance = e.target.dataset.attendance;
          applyFilters();
        });
      });

      // æ¤œç´¢
      let searchTimeout;
      document.getElementById('searchInput').addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          filters.search = e.target.value.trim();
          applyFilters();
        }, 300);
      });

      // ã‚½ãƒ¼ãƒˆ
      document.getElementById('sortSelect').addEventListener('change', (e) => {
        sortBy = e.target.value;
        sortEvents();
        displayEvents();
      });
    }
  </script>
</body>
</html>
